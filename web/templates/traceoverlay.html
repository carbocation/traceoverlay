{{define "title"}}{{$.Data.Project}}{{end}}
{{define "headinsert"}}
<style>
    .traceCanvas {
        min-height: 600px;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        /* background-color: #ffffff; */
        border:1px solid #000000;
        margin:0;
        padding:0;
        position:relative;
        left:50px;
        width:90%;
        touch-action: none;
    }
</style>
<script>

    {{/* Pre-existing annotation*/}}
    var preExistingImage = document.createElement("img");
    preExistingImage.width = {{$.Data.Width}};
    preExistingImage.height = {{$.Data.Height}};
    preExistingImage.src = "data:image/png;base64,{{$.Data.EncodedOverlayImage}}";
    
    $(document).ready(function(){
        setBrushColor({{(index $.Data.Labels 1).Color}})
    })

    {{if $.Data.HasOverlay}}
    document.onreadystatechange = function() {
        // TODO: Is this appropriate?
        // document.onreadystatechange();

        var canvas = document.getElementById("imgCanvas");
        var context = canvas.getContext("2d");

        context.drawImage(preExistingImage, 0, 0);

        // Make translucent, if configured
        fullyShade(previewAlpha);
    }
    {{end}}
</script>
{{end}}
{{define "page"}}
<div class="notif-div btn btn-primary" id="drawmessage">Hello</div>
<span>Project: <a href="/listproject">{{$.Data.Project}}</a>. Zip: {{$.Data.ManifestEntry.Zip}}. Dicom: {{$.Data.ManifestEntry.Dicom}}</span>
<br />
<button class="btn btn-primary" onclick="javascript:setBrushSize(1);">● Size:1px</button>
<button class="btn btn-primary" onclick="javascript:setBrushSize(2);">● Size:2px</button>
<button class="btn btn-primary" onclick="javascript:setBrushSize(3);">● Size:3px</button>
<button class="btn btn-primary" onclick="javascript:setBrushSize(10);">◉ Size:10px</button>
<br />
<button class="btn btn-default" onclick="javascript:setBrush('stroke');">● Trace</button>
<button class="btn btn-default" onclick="javascript:setBrush('fill');">▧ Fill</button>
<button class="btn btn-default" onclick="javascript:setBrush('line');">- Line</button>
<button class="btn btn-default" onclick="javascript:setBrush('eraser');">ⓧ Erase</button>
<!-- <button onclick="javascript:fullyShade();">Shade</button> -->
<button class="btn btn-danger" onclick="javascript:;" ontouch="javascript:;" id="undo">↺Undo</button>
<br />
<br />
<span id="labels">
{{range $k, $v := $.Data.Labels}}
    <button class="btn btn-primary {{if (eq 1 $k)}}default-color{{end}}" style="background-color:{{$v.Color}};" onclick="javascript:setBrushColor('{{$v.Color}}');">{{$v.Label}}</button>
{{end}}
</span>
<br />
<br />
<form method="POST" id="saveImage" action="/traceoverlay/{{$.Data.ManifestIndex}}">
    <input type="hidden" value="" name="imgBase64" id="imgBase64" />
</form>

<button class="btn btn-info" onclick="javascript:saveCanvas();">Save Overlay to Server</button>
<button class="btn btn-default btn-sm" onclick="javascript:downloadCanvas();">Download</button>
<br />
<br />

<canvas 
style="background-image: url('data:image/png;base64,{{$.Data.EncodedImage}}')"
class="traceCanvas" 
id="imgCanvas" 
width="{{$.Data.Width}}" 
height="{{$.Data.Height}}"></canvas>

<!-- <canvas 
style="background-image: url('{{.Assets}}/img/128px-Utah_teapot_simple_2.png')"
class="traceCanvas" 
id="imgCanvas" 
width="128" 
height="85"></canvas> -->

<script src="{{.Assets}}/js/traceoverlay.js"></script>
<script src="{{.Assets}}/js/bmp.js"></script>
<script src="{{.Assets}}/js/fill.js"></script>
{{end}}